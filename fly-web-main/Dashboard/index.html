<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="sweetalert2.all.min.js"></script>
    <script src="sweetalert2.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js" integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <link rel="stylesheet" href="sweetalert2.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            clifford: '#da373d',
          }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
</head>
    <body>
        <section class="h-full gradient-form bg-gray-200 md:h-screen">
              <div class="flex justify-center items-center flex-wrap h-full g-6 text-gray-800">
                <div class="xl:w-10/12">
                  <div class="block bg-white shadow-lg rounded-lg">
                    <div class="lg:flex lg:flex-wrap g-0">
                      <div class="lg:w-6/12 px-4 md:px-0">
                        <div class="md:p-12 md:mx-6">
                          <div class="text-center">
                            <img
                              class="mx-auto w-28"
                              src="https://flowbite.com/docs/images/logo.svg"
                              alt="logo"
                            />
                            <h4 class="text-xl font-semibold mt-1 mb-12 pb-1">Safe Navigation</h4>
                          </div>
                            <p class="mb-4">Please login to your account</p>
                            <div class="mb-4">
                              <input
                                type="text"
                                pattern="/^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/"
                                class="form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"
                                id="username"
                                placeholder="Username"
                                required
                              />
                            </div>
                            <div class="mb-4">
                              <input
                                type="password"
                                class="form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"
                                id="password"
                                placeholder="Password"
                                required
                              />
                            </div>
                            <div class="text-center pt-1 mb-12 pb-1">
                              <button
                                class="inline-block px-6 py-2.5 text-white font-medium text-xs leading-tight uppercase rounded shadow-md hover:bg-blue-700 hover:shadow-lg focus:shadow-lg focus:outline-none focus:ring-0 active:shadow-lg transition duration-150 ease-in-out w-full mb-3"
                                id="demo"
                                type="button"
                                data-mdb-ripple="true"
                                data-mdb-ripple-color="light"
                                style="
                                  background: linear-gradient(
                                    to right,
                                    #008FFF,
                                    #0082F2,
                                    #0068D7,
                                    #004FBB
                                  );
                                "
                              >
                                Login
                              </button>
                              <a class="text-gray-500" href="#!">Forgot password?</a>
                            </div>
                            <div class="flex items-center justify-between pb-6">
                            </div>
                        </div>
                      </div>
                      <div
                        class="lg:w-6/12 flex items-center lg:rounded-r-lg rounded-b-lg lg:rounded-bl-none"
                        style="
                          background: linear-gradient(to right, #008FFF, #0082F2, #0068D7, #004FBB);
                        "
                      >
                        <div class="text-white px-4 py-6 md:p-12 md:mx-6">
                          <h4 class="text-xl font-semibold mb-6">Civil Aviation Authority Sri Lanka</h4>
                          <p class="text-sm">
                            The airspace above us is a public asset with vast potential for socio-economic development that needs to be managed for the progress and prosperity of the country and posterity of the nation.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
        </section>
    </body>

    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyBg-1NzMxX195F7f3lKVR_q_24GezZuM9U",
            authDomain: "flyapp-9dc12.firebaseapp.com",
            projectId: "flyapp-9dc12",
            storageBucket: "flyapp-9dc12.appspot.com",
            messagingSenderId: "176650099472",
            appId: "1:176650099472:web:91650a7825491a26092395"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const air_traffic_controllers = db.collection('atcos');
        const results = db.collection('results');
        const users = db.collection('users');

        const getUsersData = async () => {
            const querySnapshot = await users.get();
            let list = [];
            querySnapshot.forEach(doc => list.push({id: doc.id, data: doc.data()}));
            return list;
        }

        function cleanFields(){
            document.getElementById("username").value = ""
            document.getElementById("password").value = ""
        }

        document.getElementById("demo").onclick=async ()=>{
            var user = document.getElementById("username").value;
            var pass = document.getElementById("password").value;

            const usersList = await getUsersData();

            function search (nameKey, arr){
                for (let i=0; i < arr.length; i++) {
                    if (arr[i].data.admin_email == user) {
                        return arr[i];
                    }
                }
            }

            const resultsObj = search(user,usersList);
            console.log(resultsObj)

            if(typeof resultsObj === 'object' && resultsObj !== null && resultsObj != 'undefined'){
                if(resultsObj.data.admin_email == user){
                    console.log("username is matched")
                    if(resultsObj.data.admin_password == pass){
                        console.log("password is matched too")
                        alert("Login Successfull");
                        cleanFields()
                        window.location.href= 'medical_consultancy.html'
                    }else{
                        console.log("password incorrect")
                        alert("Password Incorrect");
                        cleanFields()
                    }
                }
            }else{
                console.log("no match")
                alert("Username Incorrect");
                cleanFields()
            }
        };

    </script>

</html>